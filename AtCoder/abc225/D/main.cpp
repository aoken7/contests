#include<bits/stdc++.h>
#define all(a) a.begin(), a.end()
#define put(i) cout<<i<<endl
#define rep(i,s,n) for(long long i=s;i<(long long)(n);i++)
using namespace std;
using ll = long long;

struct train
{
    ll front = -1;
    ll end = -1;
};

template <typename T>
void putl(T t) {
    for (auto x : t) cout << x << " ";
    cout << endl;
}

int main(){
    ll n, q;
    cin >> n >> q;

    vector<train> t(n+1); 

    rep(i,0,q){
        ll c;
        cin >> c;
        if (c == 1){
            ll x, y; 
            cin >> x >> y;
            t[x].end = y;
            t[y].front = x;
        }else if(c == 2){
            ll x, y; 
            cin >> x >> y;
            t[x].end = -1;
            t[y].front = -1;
        }else if(c == 3){
            ll x;
            cin >> x;
            ll idx = x;
            while(t[idx].front != -1){
                idx = t[idx].front;
            }
            
            vector<ll> ans;
            while(idx != -1){
                ans.push_back(idx);
                idx = t[idx].end;
            }
            cout << ans.size() << ' ';
            putl(ans);
        }
    }
}
